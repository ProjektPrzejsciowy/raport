\section{Integracja Gazebo z ROS}
G³êboka integracja Gazebo z ROS jest najwiêksz± zalet± tego symulatora. Umo¿liwia j± zestaw dostarczanych pluginów do ROS w pakiecie gazebo\_ros\_pkgs.
Podstawowe funkcjonalno¶ci dostarczane razem z pakietem:
\begin{itemize}
\item pomimo integracji Gazebo pozostaje nadal samodzielnym systemem,
\item mo¿liwo¶æ zbudowania pakietów Gazebo w catkin,
\item zmniejszenie ilo¶ci kodu potrzebnego do symulacji,
\item udostêpnia u¿ytkownikowi szereg us³ug i tematów ROS do zarz±dzania symulacj± (wymienione na Rysunku \ref{fig:ros_integracja})
\end{itemize}

\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=\textwidth]{opis_systemu/materialy/gazeborosapi}   
  \caption{Schemat prezentuj±cy funkcje udostêpniane przez gazebo\_ros\_pkgs}
  \label{fig:ros_integracja}
 \end{center}
\end{figure} 

\subsection{Kompilacja pakietów Gazebo przy u¿yciu catkin}
Jak zaznaczono wcze¶niej, mo¿liwe jest bezpo¶rednie u¿ycie systemu catkin do budowania pakietów napisanych dla Gazebo. Wymaga³o to stworzenia catkin workspace -- katalogu, w którym budowane s± pakiety catkin. Stworzone przez nas pluginy Gazebo zosta³y zebrane i tak skonfigurowane, ¿e tworz± pakiet kompatybilny z ROS.

Po uruchomieniu, Gazebo tworzy w³asny wêze³ do komunikacji z ROS. Dziêki kompilacji poprzez catkin, pluginy Gazebo maj± dostêp do ROSa, bezpo¶rednio w kodzie mo¿emy odwo³ywaæ do jego funkcji. Aby siê o tym upewniæ, w World plugin umieszczono poni¿szy kod, który zatrzymuje dzia³anie Gazebo w przypadku braku komunikacji z ROS.

\begin{lstlisting}[language=c]
...                                                                                   
if ( !ros::isInitialized() )
{
	ROS_FATAL_STREAM("A ROS node for Gazebo has not been initialized");
	return;
}
...
\end{lstlisting}

\subsection{Uruchamianie Gazebo przy u¿yciu narzêdzi z ROS}
Dziêki u¿yciu catkin'a mo¿emy uruchamiaæ Gazebo za pomoc± narzêdzia roslaunch, które pozwala na automatyczne wywo³ywanie wêz³ów ROS oraz wstêpn± konfiguracjê. U³atwia to start skonfigurowanego do pracy ¶rodowiska, co sprowadza siê do jednego polecenia:
\begin{verbatim}
$ roslaunch projekt_przejsciowy l15.launch
\end{verbatim}
Aby to umo¿liwiæ, przygotowano odpowiedni plik l15.launch w podkatalogu stworzonego pakietu Gazebo $launch$. Plik launch mo¿e przy uruchomieniu wczytywaæ plik world z~konfiguracj± Gazebo lub umieszczaæ modele w odpowiednich miejscach.

\subsection{Udostêpnione funkcjonalno¶ci do komunikacji ROS}
Jak widaæ na Rysunku \ref{fig:ros_integracja}, Gazebo udostêpnia szereg funkcjonalno¶ci których mo¿na u¿yæ do integracji z ROS. 

Dla projektu najwiêksze znaczenie mia³y pluginy wysy³aj±ce dane z czujników na robocie, takich jak skaner laserowy czy kamera oraz umo¿liwiaj±ce sterowanie napêdem robota. Zosta³y one zintegrowane z modelem Pioneera.

Wêze³ tworzony przez Gazebo publikuje informacje na zewn±trz za pomoc± tematów, np. \~/model\_states, wysy³aj±cy informacje o stanie modeli aktualnie u¿ywanych w symulacji. Wêze³ dostarcza równie¿ us³ugi ROS'a, takie jak \~/spawn\_urdf\_model do ³adowania modeli robotów w formacie URDF, czy \~/delete\_model do usuwania modeli. Mog± zostaæ one wykorzystane przez u¿ytkownika naszego systemu do kontroli symulacji i zbierania danych symulacyjnych.