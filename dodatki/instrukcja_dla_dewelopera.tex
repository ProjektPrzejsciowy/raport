\chapter{Instrukcja dla dewelopera}
\section{Wstêp}

W niniejszej instrukcji znajduje siê opis wstêpnych czynno¶ci wymaganych do dalszego rozwoju symulatora. Prezentuje konfiguracjê narzêdzi, ¶rodowiska oraz obrazu a tak¿e automatyzacjê procesu budowy obrazu dla wersji deweloperskiej oraz testowej/finalnej przy pomocy pliku Dockerfile.\\
Instrukcja opisuje stan na styczeñ 2017 roku, przez co informacje w niej zawarte mog± byæ nieaktualne. Dotyczy to systemów operacyjnych wspieraj±cych Dockera, dostêpnej wersji ROS'a oraz Gazebo, a tak¿e API, z którego korzystano.  
%
\section{System operacyjny}
\label{sec:system}
Wymagany jest system Linux w architekturze 64 bitowej. Wybrane wspierane dystrybucje \textbf{Ubuntu}:
\begin{itemize}
	\item Yakkety 16.10
	\item Xenial 16.04 (LTS)
	\item Trusty 14.04 (LTS)
\end{itemize}
\textbf{Debian}:
\begin{itemize}
	\item Jessie 8.0 (LTS)
	\item Wheezy 7.7 (LTS)
\end{itemize}
Pe³na lista wspieranych dystrybucji dostêpna jest pod adresem \url{https://docs.docker.com/engine/installation/linux/}.
Praca z Dockerem mo¿liwa jest równie¿ na systemie Windows, ale niniejsza instrukcja nie zawiera opisu dla tego systemu, gdy¿ nie uda³o siê skonfigurowaæ ¶rodowiska do pracy z Dockerem w trybie graficznym.

\section{Docker}
Oprogramowanie nale¿y zainstalowaæ zgodnie z instrukcj± przygotowan± dla wybranego systemu operacyjnego umieszczon± na stronie dostawcy (link z podpunktu \ref{sec:system}).

\section{Obraz}
\label{sec:obraz}
Symulator mo¿na rozwijaæ lub modyfikowaæ, dziêki przygotowanemu obrazowi, który jest dostêpny na platformie \textbf{DockerHub} pod adresem \url{https://hub.docker.com/r/projektprzejsciowy2016/docker_lab/}. Sk³ada siê z systemu operacyjnego \textbf{Ubuntu Xenial 16.04 LTS}, systemu \textbf{ROS Kinetic} oraz \textbf{Gazebo 7.5} oraz pozosta³ych narzêdzi do komunikacji ROS-Gazebo. Je¿eli zaprezentowana konfiguracja jest akceptowalna przez dewelopera, nale¿y pobraæ obraz. W przeciwnym wypadku nale¿y zapoznaæ siê z rozdzialem \ref{sec:dockerfile}, w którym przedstawiono, jak przy pomocy pliku Dockerfile mo¿na wygenerowaæ nowy obraz.

\section{Repozytoria}
Do pracy nad symulatorem wymagane s± dwa repozytoria: \textbf{kod ¼ród³owy pluginu} zapewniaj±cego wszystkie funkcjonalno¶ci prezentowanego symulatora oraz \textbf{modele} obiektów wymaganych przez program Gazebo.\\
Kod ¼ród³owy pluginu nale¿y pobraæ lokalnie. Dostêpny jest pod adresem \url{https://github.com/ProjektPrzejsciowy/projekt_przejsciowy}. Repozytorium bêdzie dostêpne w obrazie za pomoc± mechanizmu wspó³dzielenia katalogów. Dziêki temu deweloper mo¿e pracowaæ z pluginem lokalnie, korzystaj±c z wybranego IDE a wszystkie zmiany s± widoczne z poziomu kontenera. Informacjê o tym, jak wspó³dzieliæ katalog z obrazem Dockera umieszczono w podpunkcie \ref{sec:kon}.\\
Modele obiektów znajduj± siê pod adresem \url{https://github.com/ProjektPrzejsciowy/models}. Obraz zaprezentowany w podpunkcie \ref{sec:obraz} zawiera ju¿ wymagane modele, zatem nie trzeba ich ponownie dodawaæ. Je¿eli obraz pozyskano z innego ¼ród³a, nale¿y ka¿dy utworzony kontener uzupe³niæ o modele. Informacja o tym, jak dodaæ modele do kontenera umieszczono w podpunkcie \ref{sec:kon}.

\section{Uruchamianie obrazu i konfiguracja}
\label{sec:kon}
Przed uruchomieniem obrazu nale¿y zezwoliæ na pracê obrazu Dockera z X serwerem poleceniem:
\begin{itemize}
	\item xhost +
\end{itemize}

Obraz nale¿y uruchomiæ przy pomocy komendy:
\begin{itemize}
\item docker run -it -e DISPLAY=unix\$DISPLAY -v=/tmp/.X11-unix:/tmp\/.X11-unix:rw -v$[$scie¿ka\_do\_katalogu\_lokalnego$]:[$scie¿ka\_gdzie\_ma\_byæ\_montowany\_w\_obrazie$]$ $[$nazwa obrazu$]$
\end{itemize}

W miejscu $[$scie¿ka\_do\_katalogu\_lokalnego$]$ nale¿y podaæ ¶cie¿kê do katalogu z pobranym kodem ¼ród³owym pluginu, za $[$scie¿ka\_gdzie\_ma\_byæ\_montowany\_w\_obrazie$]$ nale¿y podstawiæ: /root/catkin\_ws/src/projekt\_przejsciowy

W analogiczny sposób przy pomocy opcji -v mo¿na wspó³dzieliæ dowolny katalog z kontenerem Dockera.

Nastêpnie, pracuj±c ju¿ w kontenerze wywo³anego obrazu nale¿y dodaæ w pliku /root/.bashrc :
\begin{itemize}
	\item export GAZEBO\_PLUGIN\_PATH=/root/catkin\_ws/devel/lib/
	\item source \~/catkin\_ws/devel/setup.bash
\end{itemize} 

Je¿eli obraz nie zawiera³ modeli wymaganych przez Gazebo to nale¿y dodaæ je do katalogu /root/.gazebo/ np. pobieraj±c je z repozytorium.

Przed uruchomieniem symulatora nale¿y skompilowaæ plugin poleceniem:
\begin{itemize}
	\item cd /root/catkin\_ws/
	\item catkin\_make
\end{itemize}

\section{Dockerfile}
\label{sec:dockerfile}
Pod adresem \url{https://github.com/ProjektPrzejsciowy/docker} dostêpne s± pliki Dockerfile, które umo¿liwiaj± wygenerowanie nowego obrazu dla wersji deweloperskiej i testowej/finalnej. Na ich podstawie mo¿na wygenerowaæ w³asne obrazy, które nastêpnie mo¿na umie¶ciæ na platformie \textbf{DockerHub}.