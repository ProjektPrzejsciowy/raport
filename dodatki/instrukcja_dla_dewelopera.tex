\chapter{Instrukcja dla dewelopera}
\section{Wstêp}

W niniejszej instrukcji znajduje siê opis wstêpnych czynno¶ci wymaganych do dalszego rozwoju symulatora. Prezentuje konfiguracjê narzêdzi, ¶rodowiska oraz obrazu a tak¿e automatyzacjê procesu budowy obrazu dla wersji deweloperskiej oraz testowej/finalnej przy pomocy pliku dockerfile.\\
Instrukcja opisuje stan na styczeñ 2017 roku, przez co informacje w niej zawarte mog± byæ nieaktualne. Dotyczy to systemów operacyjnych wspieraj±cych Dockera, dostêpnej wersji ROS'a oraz Gazebo, a tak¿e API, z którego korzystano.  
%
\section{System operacyjny}
\label{sec:system}
Wymagany jest system Linux w architekturze 64 bitowej. Wybrane wspierane dystrybucje \textbf{Ubuntu}:
\begin{itemize}
	\item Yakkety 16.10
	\item Xenial 16.04 (LTS)
	\item Trusty 14.04 (LTS)
\end{itemize}
\textbf{Debian}:
\begin{itemize}
	\item Jessie 8.0 (LTS)
	\item Wheezy 7.7 (LTS)
\end{itemize}
Pe³na lista wspieranych dystrybucji dostêpna jest pod adresem \url{https://docs.docker.com/engine/installation/linux/}.
Praca z Dockerem mo¿liwa jest równie¿ na systemie Windows, ale niniejsza instrukcja nie zawiera opisu dla tego systemu, gdy¿ nie uda³o siê skonfigurowaæ ¶rodowiska do pracy z Dockerem w trybie graficznym.

\section{Docker}
Oprogramowanie nale¿y zainstalowaæ zgodnie z instrukcj± przygotowan± dla wybranego systemu operacyjnego umieszczon± na stronie dostawcy (link z podpunktu \ref{sec:system}).

\section{Obraz}
\label{sec:obraz}
Symulator mo¿na rozwijaæ lub modyfikowaæ, dziêki przygotowanemu obrazowi, który jest dostêpny na platformie \textbf{DockerHub} pod adresem \url{https://hub.docker.com/r/projektprzejsciowy2016/docker_lab/}. Sk³ada siê z systemu operacyjnego \textbf{Ubuntu Xenial 16.04 LTS}, systemu \textbf{ROS Kinetic} oraz \textbf{Gazebo 7.5} oraz pozosta³ych narzêdzi do komunikacji ROS-Gazebo. Je¿eli zaprezentowana konfiguracja jest akceptowalna przez dewelopera, nale¿y pobraæ obraz. W przeciwnym wypadku nale¿y zapoznaæ siê z rozdzialem \ref{sec:dockerfile}, w którym przedstawiono, jak przy pomocy pliku dockerfile mo¿na wygenerowaæ nowy obraz.
\subsection{Struktura plików}
W obrazie obowi±zuje standardowa dla systemów Linux struktura katalogów i plików. Jedynym katalogiem, którego dotycz± modyfikacje w ramach projektu jest katalog /root. Mo¿na wyró¿niæ w nim trzy g³ówne sk³adowe:
\begin{itemize}
	\item plik .bashrc
	\item katalog .gazebo/
	\item katalog catkin\_ws/
\end{itemize}

Plik .bashrc jest wykonywany przy ka¿dorazowym uruchomieniu shella. Dziêki temu, nie ma konieczno¶ci wykonywania poleceñ za ka¿dym razem, gdy uruchomiono obraz lub kontener - komendy wystarczy dodaæ do pliku. W punkcie \ref{sec:kon} podano, jakie komendy nale¿y dodaæ do pliku .bashrc do prawid³owej pracy symulatora.

\section{Repozytoria}
Do pracy nad symulatorem wymagane s± dwa repozytoria: \textbf{kod ¼ród³owy pluginu} zapewniaj±cego wszystkie funkcjonalno¶ci prezentowanego symulatora oraz \textbf{modele} obiektów wymaganych przez program Gazebo.\\
Kod ¼ród³owy pluginu nale¿y pobraæ lokalnie. Dostêpny jest pod adresem \url{https://github.com/ProjektPrzejsciowy/projekt_przejsciowy}. Repozytorium bêdzie dostêpne w obrazie za pomoc± mechanizmu wspó³dzielenia katalogów. Dziêki temu deweloper mo¿e pracowaæ z pluginem lokalnie, korzystaj±c z wybranego IDE a wszystkie zmiany bêd± widoczne z poziomu kontenera. Informacjê o tym, jak wspó³dzieliæ katalog z obrazem Dockera umieszczono w podpunkcie \ref{sec:kon}.\\
Modele obiektów znajduj± siê pod adresem \url{https://github.com/ProjektPrzejsciowy/models}. Obraz zaprezentowany w podpunkcie \ref{sec:obraz} zawiera ju¿ wymagane modele, zatem nie trzeba ich ponownie dodawaæ. Je¿eli obraz pozyskano z innego ¼ród³a, nale¿y ka¿dy utworzony kontener uzupe³niæ o modele. Informacja o tym, jak dodaæ modele do kontenera umieszczono w podpunkcie \ref{sec:kon}.

\section{Uruchamianie obrazu i konfiguracja}
\label{sec:kon}
Przed uruchomieniem obrazu nale¿y zezwoliæ na pracê obrazu Dockera z X serwerem poleceniem:
\begin{verbatim}
xhost +
\end{verbatim}

Obraz nale¿y uruchomiæ przy pomocy komendy:
\begin{verbatim}
docker run -it -e DISPLAY=unix$DISPLAY -v=/tmp/.X11-unix:/tmp/.X11-unix:rw \
-v [scie¿ka do katalogu lokalnego]:/root/catkin_ws/src/projekt_przejsciowy \
[nazwa obrazu]
\end{verbatim}

W miejsce $[$scie¿ka do katalogu lokalnego$]$ nale¿y podaæ ¶cie¿kê do katalogu z pobranym kodem ¼ród³owym pluginu. 

W przypadku korzystania z przygotowanego obrazu w wersji deweloperskiej  w miejsce [nazwa obrazu] nale¿y podstawiæ:
\begin{verbatim}
projektprzejsciowy2016/docker_lab:latest
\end{verbatim}

W analogiczny sposób przy pomocy opcji -v mo¿na wspó³dzieliæ dowolny katalog z~kontenerem Dockera.

Nastêpnie, nale¿y upewniæ siê, ¿e plik /root/.bashrc/ w obrazie zawiera nastêpuj±ce linie:
\begin{verbatim}
export GAZEBO_PLUGIN_PATH=/root/catkin_ws/devel/lib/
source ~/catkin_ws/devel/setup.bash
\end{verbatim}

Pierwsza linia odpowiada za do³±czenie pluginu do Gazebo. Je¿eli po uruchomieniu Gazebo plugin jest niewidoczny, ¶wiadczy to o braku linii we wspomnianym pliku lub nie skompilowaniu plików ¼ród³owych pluginu w katalogu /root/catkin\_ws/. Druga linia odpowiada za widoczno¶æ przygotowanych pakietów i mo¿liwo¶æ uruchamiania ich z dowolnej lokalizacji w terminalu. Je¿eli przygotowane pakiety s± niewidoczne w terminalu, nale¿y sprawdziæ czy plik /root/.bashrc zawiera t± liniê i czy pakiet zosta³ zbudowany w~katalogu /root/catkin\_ws/.

Je¿eli obraz nie zawiera³ modeli wymaganych przez Gazebo to nale¿y dodaæ je do katalogu /root/.gazebo/models/ np. pobieraj±c je z repozytorium.

Przed uruchomieniem symulatora nale¿y skompilowaæ plugin poleceniem:
\begin{verbatim}
cd /root/catkin_ws/
catkin_make
\end{verbatim}

\section{Dockerfile}
\label{sec:dockerfile}
Pod adresem \url{https://github.com/ProjektPrzejsciowy/docker} dostêpne s± pliki dockerfile, które umo¿liwiaj± wygenerowanie nowego obrazu dla wersji deweloperskiej i~testowej/finalnej. Na ich podstawie mo¿na wygenerowaæ w³asne obrazy, które nastêpnie mo¿na umie¶ciæ na platformie \textbf{DockerHub}.
